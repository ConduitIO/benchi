infrastructure:
  kafka:
    docker-compose: ../infra/docker-compose-kafka.yml

tools:
  kafka-connect:
    docker-compose: ../tools/docker-compose-kafka-connect.yml
  conduit:
    docker-compose: ../tools/docker-compose-conduit.yml

metrics:
  kafka:
    collector: prometheus
    settings:
      url: localhost:7071/metrics
      scrape-interval: 1s
      queries:
        - name: kafka_broker
          query: 'kafka_server_BrokerTopicMetrics_MessagesInPerSec_Count'
          interval: 1s

tests:
  - name: kafka-to-kafka
    duration: 30s

    tools:
      conduit:
        docker-compose: ./conduit/docker-compose-conduit.override.yml

    steps:
      pre-infrastructure:
      post-infrastructure:
        - name: "Create topics"
          container: "benchi-kafka"
          run: |
            /opt/kafka/bin/kafka-topics.sh --create --topic bench-in --partitions 1 --replication-factor 1 --bootstrap-server benchi-kafka:9092
            /opt/kafka/bin/kafka-topics.sh --create --topic bench-out --partitions 1 --replication-factor 1 --bootstrap-server benchi-kafka:9092
      pre-tool:
      post-tool:
      pre-test:
      during:
      post-test:
      pre-cleanup:
      post-cleanup:
